<!DOCTYPE html>
<html>
<head>
    <title>Razorpay Test</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
<h1>Test Your Payment Integration</h1>

<input type="text" id="orderId" placeholder="Enter Order ID (from Postman)" style="width: 300px; padding: 10px;">
<button onclick="startPayment()">Pay Now</button>

<script>
    async function startPayment() {
        const orderId = document.getElementById('orderId').value;
        if (!orderId) return alert("Please enter an Order ID");

        // 1. Call your backend to create the Razorpay Order
        const response = await fetch(`http://localhost:8081/api/payments/create/${orderId}`, { method: 'POST' });
        const data = await response.json();

        if (!data.razorpayOrderId) return alert("Error creating order. Check console.");

        // 2. Open Razorpay Checkout
        var options = {
            "key": "rzp_test_S64zK1wSR1JT2T", // <--- PASTE YOUR KEY ID HERE
            "amount": data.amount * 100,
            "currency": "INR",
            "name": "Test Shop",
            "description": "Payment for Order " + orderId,
            "order_id": data.razorpayOrderId,
            "handler": function (response){
                // 3. Payment Successful! Send details to backend to Verify
                verifyPayment(response, orderId);
            },
            "prefill": {
                "name": "Test User",
                "email": "test@example.com",
                "contact": "9999999999"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.open();
    }

    async function verifyPayment(paymentDetails, orderId) {
        const verifyResponse = await fetch('http://localhost:8081/api/payments/verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                orderId: orderId,
                razorpayOrderId: paymentDetails.razorpay_order_id,
                razorpayPaymentId: paymentDetails.razorpay_payment_id,
                razorpaySignature: paymentDetails.razorpay_signature
            })
        });

        const result = await verifyResponse.json();
        alert("Payment Status: " + result.status);
        console.log(result);
    }
</script>
</body>
</html>